


<script>
	/**
	 * Initiates the login process by displaying the ui 
	 * @param completionCB the callback to be invoked upon completion of the login process
	 */
	function startLoginProcess(completionCB) {
		$('#authModal').modal({ backdrop: 'static', keyboard: false });
		globals.ee.once(globals.events.LOGIN_COMPLETE, completionCB);
	}

	/**
	 * Concludes the login process by dimissing the ui and raising events
	 * @param authURL the url of the iframe that completed the auth login procedure
	 */
	function completeLoginProcess(authURL) {
		$('#authModal').modal('hide');
		globals.ee.trigger(globals.events.LOGIN_COMPLETE, [authURL]);
	}

	$(document).ready(function () {
		// load authmodal iframe content
		$('#authModal').on('show.bs.modal', function () {
			$('iframe').attr("src", globals.urls.unifile_AUTH_URL);
		});
		$('iframe').on('load', function (e) {
			// iframe page content changed. Could be login complete or login failure
			var iframeContent = $('iframe').contents();
			if (this.contentWindow.location.pathname === globals.urls.unifile_AUTH_SUBMIT_URL) {
				// see if the login completed or not, by looking for submit button
				if (iframeContent.find('input[type="submit"]').length <= 0) {
					completeLoginProcess(this.contentWindow.location.pathname); // login complete - dismiss the dialog and let anyone who wants know, know about it.
					return;
				}
			}
			// Looks like user is still on login page. Change the title to suite the app
			var title = iframeContent.find('.title');
			if (title.length > 0)
				title[0].innerHTML = "Berg10 Credentials";
		});
	});
</script>
<script type="text/javascript" src="js/unifileActions.js" async></script>