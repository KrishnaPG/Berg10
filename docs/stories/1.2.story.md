# Story 1.2: Semantic Entity Type System Enhancement

**Status:** ðŸ”„ In Progress

## Story

As a Developer,
I want to enhance the semantic entity type system with comprehensive validation and type safety features,
so that we can ensure data integrity and provide better developer experience across the platform.

## Acceptance Criteria

1.  Enhance the `ISemanticEntity` interface with additional validation rules and type safety features
2.  Implement type guards for runtime validation of semantic entities
3.  Add comprehensive test coverage for all entity type validations
4.  Document the enhanced type system with usage examples and best practices
5.  Ensure backward compatibility with existing implementations

## Dev Notes

### Enhanced Type System

Building upon the `ISemanticEntity` interface from Story 1.1, we need to add:

1. **Validation Rules**:
   - UUID format validation for entity IDs
   - Source reference validation (repository format, ref format, path format)
   - Metadata schema validation

2. **Type Guards**:
   - Runtime type checking functions
   - Error handling with detailed validation messages
   - Support for partial validation during entity creation

3. **Utility Functions**:
   - Entity creation helpers
   - Validation utilities
   - Type narrowing functions

### Implementation Plan

```typescript
// Enhanced ISemanticEntity with validation
interface ISemanticEntity {
  id: string; // UUID v4 format
  sourceRefs: ISourceReference[];
  metadata: Record<string, any>;
  createdAt: string; // ISO 8601 timestamp
  updatedAt: string; // ISO 8601 timestamp
  version: string; // Semantic versioning
}

interface ISourceReference {
  connectorType: "lakefs" | "git" | "s3" | "local";
  repository: string;
  ref: string;
  path: string;
  metadata?: Record<string, any>;
}

// Type guards
function isValidSemanticEntity(obj: any): obj is ISemanticEntity {
  // Implementation details
}

function isValidSourceReference(obj: any): obj is ISourceReference {
  // Implementation details
}

// Validation utilities
function validateEntity(entity: Partial<ISemanticEntity>): ValidationResult {
  // Implementation details
}

function createEntity(config: EntityCreationConfig): ISemanticEntity {
  // Implementation details
}
```

### Testing Requirements

- Unit tests for all validation functions
- Integration tests for entity creation workflows
- Performance tests for validation on large datasets
- Error handling tests for edge cases

### File Structure

```
packages/shared/
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ semantic-entity.types.ts (enhanced)
â”‚   â””â”€â”€ semantic-entity.validation.ts
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ entity-validation.ts
test/shared/
    â””â”€â”€ semantic-entity.test.ts
```

## Tasks / Subtasks

- [ ] **(AC: 1)** Enhance `ISemanticEntity` interface with additional fields and validation rules
- [ ] **(AC: 2)** Implement type guard functions for runtime validation
- [ ] **(AC: 2)** Create validation utility functions with detailed error messages
- [ ] **(AC: 3)** Write comprehensive unit tests for all validation functions
- [ ] **(AC: 3)** Add integration tests for entity creation workflows
- [ ] **(AC: 4)** Create documentation with usage examples and best practices
- [ ] **(AC: 5)** Ensure backward compatibility through migration guide and tests